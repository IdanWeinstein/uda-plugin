
#
# Mellanox UDA, a software plugin, accelerates Hadoop network and improves
# the scaling of Hadoop clusters executing data analytics intensive applications.
# A novel data moving protocol which uses RDMA in combination with an efficient 
# merge-sort algorithm enables Hadoop clusters based on Mellanox InfiniBand and 
# 10GbE and 40GbE RoCE (RDMA over Converged Ethernet) adapter cards to efficiently 
# move data between servers accelerating the Hadoop framework.
# Mellanox UDA is collaboratively developed with Auburn University.  
#

#in order to run UDA, you'll need:
#1. add the following two lines to the end of your hadoop-env.sh
	export HADOOP_CLASSPATH=$HADOOP_CLASSPATH:/usr/lib64/uda/uda.jar
	export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/lib64/uda/


#2. TaskTracker level settings:
#   Merge the following lines into your mapred-site.xml
#   NOTE: this must be in mapred-*.xml, because it must be considered in TaskTracker initialization
#         hence, it can't be just given per job
	<?xml version="1.0"?>
	<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
	<configuration>

		<property>
		<name>mapred.tasktracker.shuffle.provider.plugin</name>
			<value>com.mellanox.hadoop.mapred.UdaShuffleProviderPlugin</value>	
			<description>
				represents plugin for shuffle at TaskTracker side 
				default value is: 
				(empty string)
				You can also try: 
				com.mellanox.hadoop.mapred.UdaShuffleProviderPlugin
			</description>
		</property>
					
		<property>
			<name>mapred.tasktracker.dns.interface</name>
			<value>ib0</value>
		</property>
		
		<property>
			<name>mapred.uda.log.tracelevel</name>
				<description>level of debug prints in uda logs:
					NONE -> 0,
					FATAL -> 1,
					ERROR -> 2,
					WARN -> 3,
					INFO -> 4,
					DEBUG -> 5,
					TRACE -> 6,
					ALL -> 7,         
				</description>
			<value>2</value>
		</property>
				
	</configuration>


#3. Job level settings:
#   The following are ADDITIONAL setting that must be given to any UDA job.
#   it can be provided either in command line or in mapred-*.xml
	<?xml version="1.0"?>
	<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
	<configuration>
		
		<property>
			<name>mapred.reducetask.shuffle.consumer.plugin</name>
			<value>com.mellanox.hadoop.mapred.UdaShuffleConsumerPlugin</value>
			<description>
				represents plugin for shuffle at ReduceTask side 
				default value is: 
				org.apache.hadoop.mapred.ReduceCopier
				You can also try: 
				com.mellanox.hadoop.mapred.UdaShuffleConsumerPlugin
			</description>
		</property>
		
	</configuration>

#4. OPTIONAL: 
#   The following are optional parameters for UDA with their defaults
#   Users may decide to change defaults in their environment
	<?xml version="1.0"?>
	<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
	<configuration>
				
		<property>
			<name>mapred.rdma.cma.port</name>
			<value>9011</value>
		</property>
		
		<property>
			<name>mapred.rdma.wqe.per.conn</name>
			<value>256</value>
		</property>
		
		<property>
			<name>mapred.rdma.buf.size</name>
			<value>1024</value>
			<description>
				Used by both UdaShuffleProvider and UdaShuffleConsumer:
				- UdaShuffleProvider (TaskTracker): determines the RDMA&AIO Buffers size to satify Map Output's RDMA fetch requests
				- UdaShuffleConsumer (Reducer): user prefered RDMA buffer size for fetching  map outputs
				Size in KB and must be alligned to page size.
			</description>
		</property>
		
		<property>
			<name>mapred.rdma.buf.size.min</name>
			<value>32</value>
			<description>
				UDA reducer allocates RDMA buffers according to 'mapred.rdma.buf.size'
				If the buffer size is too big then a smaller buffer will be used while 'mapred.rdma.buf.size.min' is the limit.
				Bigger RDMA buffers improves the shuffle performance. 
				Too small buffer size can sagnificantly reduce the perfomance.
				Task will fail in case the redcuer need to use smaller buffer size than 'mapred.rdma.buf.size.min'.
			</description>
		</property>
		
	</configuration>
